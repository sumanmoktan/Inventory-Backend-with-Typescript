// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Customer {
  id            String    @id @default(auto()) @map("_id") @db.ObjectId
  customerType  CustomerType 
  firstName     String
  lastName      String
  phone         String @unique
  gender        Gender
  country       String
  location      String
  maxCreditLimit Float
  maxCreditDays Int
  unpaidCreditAmount Int? @default(0) 
  taxPin        String?
  dob           DateTime?
  email         String?   @unique
  nationalID    String    @unique
  sales         Sale[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum CustomerType {
  RETAIL
  WHOLESALE
  DISTRIBUTOR
  OTHER
}

enum Gender {
  MALE
  FEMALE
}

model User {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  email         String  @unique
  username      String  @unique
  password      String
  firstName      String
  lastName      String
  phone         String  @unique
  dob           DateTime?
  gender        Gender
  image         String?
  role          Role @default(ATTENDANT)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  shops         Shop[]    //Relation to shops managed by the user
}

enum Role {
  ADMIN
  ATTENDANT
}

model Shop {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  slug  String @unique
  location      String
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  adminId       String  @db.ObjectId
  products      Product[]
  admin         User      @relation(fields: [adminId], references: [id]) //Relation to the admin who manages to shop 
  attendantIds  String[]  @db.ObjectId  //Array of ObjectIds referencing attendants
 
}

model Supplier {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  supplierType      SupplierType
  name              String
  contactPerson     String
  phone             String    @unique
  email             String?    @unique
  location          String
  country           String
  website           String?
  taxPin            String?
  registrationNumber String?  @unique
  bankAccountNumber   String?
  bankName          String?
  paymentTerms      String?
  logo              String?   @default("https://example.com/default-logo.png")
  rating            Float?
  notes             String?
  products          Product[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum SupplierType {
  MANUFACTURER
  DISTRIBUTOR
  WHOLESALE
  RETAILER
  OTHER
}

model Unit {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  name          String
  abbreviation  String
  slug          String  @unique
  products      Product[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Brand {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  name       String
  slug       String   @unique
  products   Product[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Category{
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  slug        String    @unique
  products    Product[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Product {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  description String?
  batchNumber String?
  barCode     String?  @unique
  image       String?  @default("https://example.com/default-logo.png")
  tax         Int?
  alertQty    Int
  stockQty    Int
  price       Int
  wholesalePrice Int @default(0)
  buyingPrice Int?
  sku         String  @unique
  productCode String  @unique
  slug        String  @unique
  supplierId  String  @db.ObjectId
  unitId      String  @db.ObjectId
  shopId      String  @db.ObjectId @default("693c011a613b581bcade7998")
  brandId     String  @db.ObjectId
  categroyId  String  @db.ObjectId
  expiryDate  DateTime? @default("2025-12-31T23:59:59Z")
  unit        Unit    @relation(fields:[unitId], references:[id])
  shop        Shop    @relation(fields:[shopId], references:[id])
  brand       Brand   @relation(fields:[brandId], references:[id])
  category    Category @relation(fields:[categroyId], references:[id])
  supplier    Supplier  @relation(fields:[supplierId], references:[id])
  saleItems       SaleItems[]
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

enum PaymentStatus {
  PAID
  CREDIT
}

model Sale {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  customerId        String   @db.ObjectId
  customerName      String
  orderNumber       String   @unique
  customerEmail     String?
  orderAmount       Int
  balanceAmount     Int?     @default(0)
  paidAmount        Int
  orderType         String?
  paymentStatus     PaymentStatus @default(PAID)
  paymentMethod     String?
  transactionCode   String?

  //Relationships
  salesItems        SaleItems[]
  customer          Customer  @relation(fields:[customerId], references:[id]) 
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model SaleItems {
  id            String   @id @default(auto()) @map("_id") @db.ObjectId
  saleId       String  @db.ObjectId
  productId     String  @db.ObjectId
  qty           Int
  salePrice     Float
  productName   String
  productImage  String
  customerName  String
  customerEmail String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  //Relationships
  product       Product   @relation(fields:[productId], references:[id])
  sale          Sale      @relation(fields:[saleId], references:[id])
}
